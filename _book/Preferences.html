
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Preferences Â· Theia</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="Commands_Keybindings.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Architecture.html">
            
                <a href="Architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Authoring_Extensions.html">
            
                <a href="Authoring_Extensions.html">
            
                    
                    Developing an extension
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Internals.html">
            
                <a href="Internals.html">
            
                    
                    Internals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Commands_Keybindings.html">
            
                <a href="Commands_Keybindings.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6" data-path="Preferences.html">
            
                <a href="Preferences.html">
            
                    
                    Preferences
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Preferences</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Theia has a preference service which allows modules to get preference values, contribute default preferences and listen for preference changes.</p>
<p>Preferences can be saved in the root of the workspace under <code>.theia/settings.json</code> or under <code>$HOME/.theia/settings.json</code> on Linux systems. For Windows systems, the user settings will by default be in the <code>%USERPROFILE%/.theia/settings.json</code> (something like <code>C:\Users\epatpol\.theia/settings.json</code>)</p>
<p>As of right now the files must contain a valid a JSON containing the names and values of preferences (note that the following preference names are not official and only used as an example). You can also add comments to the settings.json file if needed i.e</p>
<pre><code>{
    // Enable/Disable the line numbers in the monaco editor
    &quot;monaco.lineNumbers&quot;: &quot;off&quot;,
    // Tab width in the editor
    &quot;monaco.tabWidth&quot;: 4,
    &quot;fs.watcherExcludes&quot;: &quot;path/to/file&quot;
}
</code></pre><p>Let&apos;s take the filesystem as an example of a module using the preference service</p>
<h2 id="contributing-default-preferences-as-a-module-with-inversify">Contributing default preferences as a module with inversify</h2>
<p>To contribute some preference values. A module must contribute a valid json schema that will be used to validate the preferences. A module must bind the following PreferenceContribution to a value like this:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> PreferenceSchema {
    [name: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">Object</span>,
    properties: {
        [name: <span class="hljs-built_in">string</span>]: object
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> PreferenceContribution {
    readonly schema: PreferenceSchema;
}
</code></pre>
<p>For instance, the filesystem binds it like so : </p>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> filesystemPreferenceSchema: PreferenceSchema = {
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,
    <span class="hljs-string">&quot;properties&quot;</span>: {
        <span class="hljs-string">&quot;files.watcherExclude&quot;</span>: {
            <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;List of paths to exclude from the filesystem watcher&quot;</span>,
            <span class="hljs-string">&quot;additionalProperties&quot;</span>: {
                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;boolean&quot;</span>
            }
        }
    }
};

bind(PreferenceContribution).toConstantValue(
{ 
    schema: filesystemPreferenceSchema 
});
</code></pre>
<p>Here are some useful links for contributing a validation schema:</p>
<ul>
<li><a href="http://json-schema.org/documentation.html" target="_blank">JSON schema spec</a></li>
<li><a href="https://jsonlint.com/" target="_blank">Online JSON validator</a></li>
<li><a href="http://www.jsonschemavalidator.net/" target="_blank">Online JSON schema validator</a></li>
</ul>
<h2 id="listening-for-a-preference-change-via-a-configuration">Listening for a preference change via a configuration</h2>
<p>To use the value of a preference, simply get the injected PreferenceService from the container</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">const</span> preferences = ctx.container.get(PreferenceService);
</code></pre>
<p>In the case of the filesystem, the service is fetched at the beginning for the bindings. There, you can use the onPreferenceChanged method to register a pref changed callback.</p>
<pre><code class="lang-typescript">
<span class="hljs-keyword">constructor</span>(@inject(PreferenceService) protected readonly prefService: PreferenceService
    prefService.onPreferenceChanged(e =&gt; { callback }
</code></pre>
<p>where the event received <code>e</code> is like this:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> PreferenceChangedEvent {
    readonly preferenceName: <span class="hljs-built_in">string</span>;
    readonly newValue?: <span class="hljs-built_in">any</span>;
    readonly oldValue?: <span class="hljs-built_in">any</span>;
}
</code></pre>
<p>Although this can be used directly in the needed class, the filesystem provides a proxy preference service specific to the filesystem preferences (which uses the preference service in the background). This allows for faster and more efficient searching for the preference (as it searches for the preference in the filesystem preference service, and not on all preferences via the more generic preference service). It&apos;s also more efficient in the sense that only the modules watching for specific preferences related to a module will be notified. To do so, there is a proxy interface for the filesystem configuration that is bound like so using the preference proxy interface:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> PreferenceProxy&lt;T&gt; = Readonly&lt;T&gt; &amp; Disposable &amp; PreferenceEventEmitter&lt;T&gt;;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPreferenceProxy</span>&lt;<span class="hljs-title">T</span> <span class="hljs-title">extends</span> <span class="hljs-title">Configuration</span>&gt;(<span class="hljs-params">preferences: PreferenceService, configuration: T</span>): <span class="hljs-title">PreferenceProxy</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
    <span class="hljs-comment">/* Register a client to the preference server
    When a preference is received, it is validated against the schema and then fired if valid, otherwise the default value is provided.

    This proxy is also in charge of calling the configured preference service when the proxy object is called i.e editorPrefs[&apos;preferenceName&apos;]

    It basically forwards methods to the real object, i.e dispose/ready etc.
}
</span></code></pre>
<p>To use that proxy, simply bind it to a new type X = PreferenceProxy<configuration_interface> and then bind(X) to a proxy using the method above.</configuration_interface></p>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> FileSystemConfiguration {
    <span class="hljs-string">&apos;files.watcherExclude&apos;</span>: { [globPattern: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">boolean</span> }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> FileSystemPreferences = Symbol(<span class="hljs-string">&apos;FileSystemPreferences&apos;</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> FileSystemPreferences = PreferenceProxy&lt;FileSystemConfiguration&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createFileSystemPreferences</span>(<span class="hljs-params">preferences: PreferenceService</span>): <span class="hljs-title">FileSystemPreferences</span> </span>{
    <span class="hljs-keyword">return</span> createPreferenceProxy(preferences, defaultFileSystemConfiguration, filesystemPreferenceSchema);
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindFileSystemPreferences</span>(<span class="hljs-params">bind: interfaces.Bind</span>): <span class="hljs-title">void</span> </span>{

    bind(FileSystemPreferences).toDynamicValue(ctx =&gt; {
        <span class="hljs-keyword">const</span> preferences = ctx.container.get(PreferenceService);
        <span class="hljs-keyword">return</span> createFileSystemPreferences(preferences);
    });

    bind(PreferenceContribution).toConstantValue({ schema: filesystemPreferenceSchema });

}
</code></pre>
<p>Finally, to use the filesystem configuration in your module. Simply inject it where you need it. You can then access the preference like so (filesystem example) :</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">const</span> patterns = <span class="hljs-keyword">this</span>.preferences[<span class="hljs-string">&apos;files.watcherExclude&apos;</span>];
</code></pre>
<p>and you can also register for preference change like so:</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">this</span>.toDispose.push(preferences.onPreferenceChanged(e =&gt; {
    <span class="hljs-keyword">if</span> (e.preferenceName === <span class="hljs-string">&apos;files.watcherExclude&apos;</span>) {
        <span class="hljs-keyword">this</span>.toRestartAll.dispose();
    }
}));
</code></pre>
<pre><code class="lang-typescript"><span class="hljs-keyword">constructor</span>(...,
        @inject(FileSystemPreferences) protected readonly preferences: FileSystemPreferences) {
    ...
         <span class="hljs-keyword">this</span>.toDispose.push(preferences.onPreferenceChanged(e =&gt; {
            <span class="hljs-keyword">if</span> (e.preferenceName === <span class="hljs-string">&apos;files.watcherExclude&apos;</span>) {
                <span class="hljs-keyword">this</span>.toRestartAll.dispose();
            }
        }));
    ...
}
</code></pre>
<h2 id="preference-flow-when-modifying-a-preference">Preference flow when modifying a preference</h2>
<p>As of right now, when a settings.json is modified either in the ${workspace}/.theia/ or in the <code>os.homedir()</code>/.theia/, this will trigger an event from the JSON preference server. Currently, there&apos;s a CompoundPreferenceServer that manages the different servers (scopes) like workspace/user/defaults (provided via the contributions above). Next, the PreferenceService manages this server and adds a more convenient api on top of it (i.e getBoolean, getString etc.). It also allows clients to registers for preference changes. This PreferenceService can then be used either directly via injection in the modules, or via a more specific proxy (like the filesystem configuration from above).</p>
<p>In the case of the preference file being modified, the flow would then be:</p>
<p>.theia/settings.json -&gt; JsonPreferenceServer -&gt; CompoundPreferenceServer -&gt; PreferenceService -&gt; PreferenceProxy<filesystemconfiguration> -&gt; FileSystemWatcher</filesystemconfiguration></p>
<h2 id="fetching-the-value-of-a-preference">Fetching the value of a preference</h2>
<p>In the case of the filesystem, one would use the same proxied config as above to access the preferences.</p>
<pre><code class="lang-typescript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.prefService[<span class="hljs-string">&apos;preferenceName&apos;</span>]) {
    ...
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.prefService[<span class="hljs-string">&apos;preferenceName2&apos;</span>]) {
    ...
    }
})
</code></pre>
<p>This works because, as we have seen it above, the proxy will simply call prefService.get(&apos;preferenceName&apos;).</p>
<h2 id="todofixme-for-preferences">TODO/FIXME for preferences</h2>
<ul>
<li>Add scopes with server priority in CompoundPreferenceServer</li>
<li>Add autocomplete/description when modifying the settings.json from within theia</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Commands_Keybindings.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Commands">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Preferences","level":"1.6","depth":1,"previous":{"title":"Commands","level":"1.5","depth":1,"path":"Commands_Keybindings.md","ref":"Commands_Keybindings.md","articles":[]},"dir":"ltr"},"config":{"plugins":["livereload"],"root":"./doc","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Theia","gitbook":"*","description:":"bla und blub"},"file":{"path":"Preferences.md","mtime":"2017-10-05T07:09:04.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-02-19T08:08:33.123Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

